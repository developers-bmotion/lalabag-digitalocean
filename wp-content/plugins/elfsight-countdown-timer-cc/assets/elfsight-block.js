/*
    Elfsight Countdown Timer
    Version: 1.2.0
    Release date: Thu May 16 2019

    https://elfsight.com

    Copyright (c) 2019 Elfsight, LLC. ALL RIGHTS RESERVED
*/

!function(wp,$){let IconBlock=function(e){return wp.element.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"20",height:"20",viewBox:"0 0 20 20",class:"dashicon"},[wp.element.createElement("path",{id:"a",d:"M10 20c-4.97 0-9-3.938-9-8.795C1 6.347 5.03 2.41 10 2.41s9 3.937 9 8.795C19 16.062 14.97 20 10 20zm0-1.446c4.153 0 7.52-3.29 7.52-7.35 0-4.058-3.367-7.349-7.52-7.349s-7.52 3.29-7.52 7.35c0 4.059 3.367 7.35 7.52 7.35zm.863-16.867V2.77a.853.853 0 0 1-.863.843.853.853 0 0 1-.863-.843V1.687h-.123A.853.853 0 0 1 8.15.843c0-.465.386-.843.863-.843h1.972c.477 0 .863.378.863.843a.853.853 0 0 1-.863.844h-.123zm-.003 9.584a.825.825 0 0 1-.113.42.85.85 0 0 1-.318.312l-3.38 1.907a.875.875 0 0 1-1.18-.309.825.825 0 0 1-.002-.84.85.85 0 0 1 .319-.312l2.951-1.665V5.663c0-.466.386-.844.863-.844s.863.378.863.844v5.542c0 .022 0 .044-.003.066z"})])};if(void 0===wp.components||void 0===wp.blocks||void 0===wp.element||void 0===wp.i18n)return!1;const{__:__}=wp.i18n,el=wp.element.createElement,registerBlockType=wp.blocks.registerBlockType,ServerSideRender=wp.components.ServerSideRender;let initTimeout;function initWidget(){clearTimeout(initTimeout),initTimeout=setTimeout(function(){let widgets=document.querySelectorAll("[data-elfsight-countdown-timer-options]");Array.prototype.slice.call(widgets).forEach(function(widget){let options=widget.getAttribute("data-elfsight-countdown-timer-options"),data=JSON.parse(decodeURIComponent(options));eval("eappsCountdownTimer(widget, data)"),widget.removeAttribute("data-elfsight-countdown-timer-options"),widget.removeAttribute("data-elfsight-countdown-timer-version"),widget.closest(".elfsight-block-widget-container").classList.add("elfsight-block-widget-initialized")})},1500)}class Widget extends React.Component{componentDidMount(){initWidget()}componentDidUpdate(){initWidget()}render(){return this.props.id?el("div",{className:"elfsight-block-widget-container"},el(ServerSideRender,{block:"elfsight-countdown-timer/block",attributes:{id:this.props.id||"1"}}),el("div",{className:"elfsight-block-widget-placeholder"},el(IconBlock,{}),el("span",{},"Elfsight Countdown Timer"))):[]}}class Button extends React.Component{render(){let e=document.location.origin+document.location.pathname.replace("post.php","admin.php")+"?page=elfsight-countdown-timer#";return el("a",{href:e+this.props.href,target:"_blank",className:this.props.className},this.props.text)}}class WidgetSelect extends React.Component{constructor(){super(),this.state={widgets:[]}}setWidget(e){e.preventDefault();let t=e.target.querySelector("option:checked");this.props.setAttributes({id:t.value.toString()})}componentDidMount(){$.get(ajaxurl,{action:"elfsight-countdown-timer".replace(/-/g,"_")+"_widgets_api",endpoint:"list"}).then(e=>{if(e.status){this.setState({widgets:e.data});let t=e.data.reduce(function(e,t){return e[t.id]=t,e},{}),i=!(!t[this.props.id]||"1"!==t[this.props.id].active);!i&&e.data[0]?this.props.setAttributes({id:parseInt(e.data[0].id),exist:!0}):this.props.setAttributes({id:this.props.id,exist:i})}})}render(){return this.state.widgets.length>0?el("div",{className:"components-base-control"},el("div",{className:"components-base-control__field"},el("select",{className:"components-select-control__input",id:"elfsight-countdown-timer-block-control-id",value:this.props.id,onChange:this.setWidget.bind(this)},this.state.widgets.map(e=>wp.element.createElement("option",{value:e.id},[e.name]))))):[]}}registerBlockType("elfsight-countdown-timer/block",{title:"Elfsight Countdown Timer",description:"Create various counters and timers to stimulate purchasing on your website",icon:{src:IconBlock},category:"widgets",keywords:["Elfsight Countdown Timer","Elfsight"],supports:{html:!1},attributes:{id:{type:"string"},exist:{type:"bool",default:!1}},edit:function(e){const{attributes:{id:t,exist:i},setAttributes:s}=e;return el(wp.element.Fragment,{},el(wp.editor.InspectorControls,{},el(wp.components.PanelBody,{className:"elfsight-block-panel",title:"Select widget"},el(WidgetSelect,{id:t,setAttributes:function(t){e.setAttributes(t)}}),i?el("div",{className:"elfsight-block-panel-group"},el(Button,{href:"/edit-widget/"+t,className:"components-button is-button is-default is-large elfsight-block-panel-button",text:__("Edit Widget")}),el(Button,{href:"/add-widget/",className:"elfsight-block-panel-link",text:__("Create new widget")})):el("div",{className:"elfsight-block-panel-group"},el("span",{},__("No widgets yet")),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-panel-button",text:__("Create Widget")})))),i?el(Widget,{id:t,exist:i}):null,i?null:el("div",{className:"elfsight-block-form"},el("div",{className:"elfsight-block-form-header"},el(IconBlock,{}),el("span",{},"Elfsight Countdown Timer")),el("div",{className:"elfsight-block-form-text"},__("Create various counters and timers to stimulate purchasing on your website"),el("br"),el("strong",{},__("Let's create your first widget!"))),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-form-button",text:__("Create Widget")})))},save:function(){return null}})}(wp,jQuery);